name: Build and Push ig-conformance Image to ECR

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      - name: Debug workspace
        run: |
          echo "PWD: $(pwd)"
          ls -la
          ls -la layers/ig-conformance/

      - name: Build ig-conformance image
        uses: delivops/ecr-build-action@v0.0.10
        with:
          path: ./layers/ig-conformance/
          image_name: "somerset-647582858282-dev-account-ecr"
          tag: "latest,sha-${{ github.sha }}"
          build_args: "ENV=dev,VERSION=${{ github.sha }}"
          dockerfile_path: ./layers/ig-conformance/Dockerfile
          aws_account_id: "647582858282"
          aws_region: "eu-west-2"
          aws_role: "GithubRunnerRole"
          no_cache: true
